<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Maximum Reality: Dimensions</title>
    <style>
        :root {
            --glitch-color: rgba(0, 255, 255, 0.1);
            --neon-glow: #0ff;
        }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #000;
            -webkit-user-select: none; user-select: none; touch-action: none;
        }
        #gameCanvas { display: block; width: 100vw; height: 100vh; image-rendering: pixelated; }
        .ui-layer {
            position: absolute; top: env(safe-area-inset-top); width: 100%;
            color: #0ff; font-family: 'Courier New', monospace;
            padding: 20px; z-index: 100; pointer-events: none;
        }
        #score { font-size: 24px; text-shadow: 0 0 10px #0ff; font-weight: bold; }
        #status { font-size: 14px; margin-top: 5px; opacity: 0.8; }
        
        /* Michelin Star Snack Notification */
        #snack-alert {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px; color: #fff;
            text-shadow: 0 0 20px #ffaa00;
            display: none; z-index: 101;
        }
    </style>
</head>
<body>
    <div id="snack-alert">⭐ SNACK ATTACK ⭐</div>
    <div class="ui-layer">
        <div id="score">DIMENSION: 0</div>
        <div id="status">INITIATING QUANTUM SYNC...</div>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const ASSETS = {
    bg: 'gg-bg.png',
    floor: 'floor.png',
    azul: ['Azul-doll.png', 'Azul-doll2.png', 'Azul-doll3.png', 'Azul-doll4.png'],
    buildings: ['building-a.png', 'building-b.png', 'building-c.png'],
    loriBlur: 'lori-blur.png',
    portal: 'snack-portal.png',
    snacks: ['mochkil-burger.png', 'pink-donut.png', 'taco.png'],
    obstacles: ['cardboard_tank.png', 'dumpster.png']
};

let gameState = 'START', score = 0, frame = 0, gameSpeed = 7;
let jumpHeight = 0, yVelocity = 0, shake = 0;
let isHackerMode = false, isTransitioning = false;
const gravity = 1.0, imgCache = {};

// Load Assets
function load() {
    Object.keys(ASSETS).forEach(key => {
        if (Array.isArray(ASSETS[key])) {
            imgCache[key] = ASSETS[key].map(src => { let i = new Image(); i.src = src; return i; });
        } else {
            imgCache[key] = new Image(); imgCache[key].src = ASSETS[key];
        }
    });
}
load();

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

let gameObjects = [], backgroundProps = [];

function spawn() {
    // 1. Rare Lori-Blur Rift (Atmospheric)
    if (Math.random() > 0.985) {
        backgroundProps.push({ x: canvas.width + 200, y: canvas.height - 450, w: 200, h: 320, type: 'rift', passed: false });
    }
    
    // 2. Snack Portal (Hacker Mode Trigger)
    if (frame > 0 && frame % 1200 === 0) {
        gameObjects.push({ x: canvas.width + 100, y: canvas.height - 350, w: 150, h: 250, type: 'portal', img: imgCache.portal });
    }

    // 3. Regular Items
    if (frame % 70 === 0) {
        const isSnack = Math.random() > 0.6;
        gameObjects.push({
            x: canvas.width + 100, y: canvas.height - 180, w: 60, h: 60,
            type: isSnack ? 'snack' : 'obstacle',
            img: isSnack ? imgCache.snacks[Math.floor(Math.random()*3)] : imgCache.obstacles[Math.floor(Math.random()*2)]
        });
    }
}

function handlePortal() {
    isHackerMode = true;
    shake = 30;
    const alert = document.getElementById('snack-alert');
    alert.style.display = 'block';
    document.getElementById('status').innerText = "HACKER CAT MODE: ACTIVE";
    
    setTimeout(() => {
        isHackerMode = false;
        alert.style.display = 'none';
        document.getElementById('status').innerText = "DIMENSION STABILIZED";
    }, 5000); // 5 seconds of Michelin Star Power
}

function drawWorld() {
    if (imgCache.bg.complete) ctx.drawImage(imgCache.bg, 0, 0, canvas.width, canvas.height);
    ctx.fillStyle = document.documentElement.style.getPropertyValue('--glitch-color');
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Parallax
    const layers = [{img: imgCache.buildings[2], s: 0.5, op: 0.2}, {img: imgCache.buildings[1], s: 1.5, op: 0.5}, {img: imgCache.buildings[0], s: 3, op: 0.8}];
    layers.forEach(l => {
        if (!l.img.complete) return;
        let x = -(frame * l.s) % canvas.width;
        ctx.globalAlpha = l.op;
        ctx.drawImage(l.img, x, canvas.height * 0.2, canvas.width, canvas.height * 0.7);
        ctx.drawImage(l.img, x + canvas.width, canvas.height * 0.2, canvas.width, canvas.height * 0.7);
    });
    ctx.globalAlpha = 1;

    // Rifts
    backgroundProps.forEach((p, i) => {
        p.x -= 4; 
        ctx.globalAlpha = 0.4 + Math.random() * 0.3;
        if (imgCache.loriBlur.complete) ctx.drawImage(imgCache.loriBlur, p.x, p.y, p.w, p.h);
        if (!p.passed && p.x < 150) {
            p.passed = true; shake = 15;
            const colors = ['rgba(0,255,255,0.2)', 'rgba(255,0,255,0.2)', 'rgba(0,255,0,0.1)'];
            document.documentElement.style.setProperty('--glitch-color', colors[Math.floor(Math.random()*3)]);
        }
        if (p.x < -300) backgroundProps.splice(i, 1);
    });
    ctx.globalAlpha = 1;

    // Floor
    if (imgCache.floor.complete) {
        let fX = -(frame * gameSpeed) % 100;
        for (let i = 0; i < (canvas.width / 100) + 2; i++) {
            ctx.drawImage(imgCache.floor, fX + (i * 100), canvas.height - 100, 100, 100);
        }
    }
}

function loop() {
    ctx.save();
    if (shake > 0) { ctx.translate(Math.random()*shake, Math.random()*shake); shake *= 0.9; }
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawWorld();

    if (gameState === 'PLAYING') {
        frame++; spawn();
        jumpHeight -= yVelocity; yVelocity += gravity;
        if (jumpHeight <= 0) { jumpHeight = 0; yVelocity = 0; }

        // Azul Run Cycle
        const aFrame = Math.floor(frame / 6) % 4;
        ctx.save();
        if (isHackerMode) { ctx.shadowBlur = 20; ctx.shadowColor = "#0ff"; ctx.filter = "brightness(1.5)"; }
        if (imgCache.azul[aFrame].complete) ctx.drawImage(imgCache.azul[aFrame], 150, canvas.height - 210 - jumpHeight, 100, 120);
        ctx.restore();

        // Game Objects
        gameObjects.forEach((obj, i) => {
            obj.x -= gameSpeed;
            if (obj.x < 220 && obj.x > 150 && jumpHeight < (obj.type === 'portal' ? 200 : 50)) {
                if (obj.type === 'snack') { score += 100; gameObjects.splice(i, 1); }
                else if (obj.type === 'portal') { handlePortal(); gameObjects.splice(i, 1); }
                else if (obj.type === 'obstacle' && !isHackerMode) { gameState = 'GAMEOVER'; }
                else if (obj.type === 'obstacle' && isHackerMode) { score += 50; gameObjects.splice(i, 1); }
            }
            if (obj.img.complete) ctx.drawImage(obj.img, obj.x, obj.y, obj.w, obj.h);
            if (obj.x < -200) gameObjects.splice(i, 1);
        });
        document.getElementById('score').innerText = `DIMENSION: ${score}`;
    } else {
        ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = "#0ff"; ctx.textAlign = "center"; ctx.font = "20px Courier";
        ctx.fillText(gameState === 'START' ? "TAP TO SYNC WITH AZUL" : "REALITY COLLAPSED - TAP TO REBOOT", canvas.width/2, canvas.height/2);
    }
    ctx.restore();
    requestAnimationFrame(loop);
}

window.addEventListener('touchstart', (e) => {
    if (gameState !== 'PLAYING') {
        gameState = 'PLAYING'; score = 0; frame = 0; gameObjects = []; backgroundProps = [];
        document.getElementById('status').innerText = "AZUL ONLINE";
    } else if (jumpHeight === 0) yVelocity = -18;
    e.preventDefault();
}, {passive: false});

loop();
</script>
</body>
</html>
