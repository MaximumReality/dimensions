<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Maximum Reality: Universal Infinity</title>
<style>
    body, html { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#000; -webkit-user-select:none; touch-action:none;}
    #gameCanvas { display:block; width:100vw; height:100vh; background:#000; image-rendering: pixelated; }

    .ui-layer {
        position:absolute; top:env(safe-area-inset-top); left:20px;
        color:#0ff; font-family:'Courier New', monospace;
        z-index:100; pointer-events:none; text-shadow:0 0 8px #0ff;
    }
    #score { font-size:24px; font-weight:bold; transition: 0.2s; }
    .new-record { color: #fff; text-shadow: 0 0 15px #fff, 0 0 25px #0ff; transform: scale(1.1); }

    .controls {
        position:absolute; top:calc(env(safe-area-inset-top) + 10px); right:20px;
        display:flex; gap:15px; z-index:150;
    }
    .btn {
        font-size:24px; background:rgba(0,255,255,0.15); border:1.5px solid #0ff;
        border-radius:8px; padding:8px; color:#0ff; cursor:pointer;
        backdrop-filter: blur(5px); display:flex; align-items:center; justify-content:center;
    }

    #bsod {
        position:fixed; top:0; left:0; width:100%; height:100%;
        background:#0000aa; color:#fff; font-family:'Courier New';
        display:none; z-index:200; padding:50px; box-sizing:border-box;
    }

    #flash {
        position:fixed; top:0; left:0; width:100%; height:100%;
        background:#fff; opacity:0; z-index:250;
        pointer-events:none; transition:opacity 0.1s;
    }
</style>
</head>
<body>
<div id="bsod">
    <h1>:(</h1>
    <p>CRITICAL_DIMENSION_ERROR</p>
    <p>REBOOTING SIMULATION...</p>
</div>
<div id="flash"></div>

<div class="controls">
    <a href="https://MaximumReality.xyz" class="btn">üè†</a>
    <div id="muteBtn" class="btn">üîä</div>
    <div id="pauseBtn" class="btn">‚èØÔ∏è</div>
</div>

<div class="ui-layer">
    <div id="score">DIMENSION: 0</div>
    <div id="highScore">BEST: 0</div>
    <div id="status">AZUL ONLINE...</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- AUDIO CONFIG ---
const bgMusic = new Audio('password-infinity.mp3'); bgMusic.loop = true;
const beastModeSfx = new Audio('beast_mode.mp3');

// --- GAME STATE ---
let isMuted=false, isPaused=false, gameState='START';
let score=0, frame=0, gameSpeed=7, dimensionHue=0, timeScale=1.0;
let jumpHeight=0, yVelocity=0, shake=0, bonusCount=0, coyoteFrames=0;
let currentZone='CYBER', portalActive=false, beastModePlayed=false;

const gravity = 1.2, GROUND_Y_OFFSET=100;
let floorY, highScore=localStorage.getItem('maxRealityHighScore')||0;

// --- ASSET CACHE ---
const ASSETS={
    bg:'gg-bg.png', snackBg:'hot-food-c-store-wp.JPG', floor:'floor.png', earthquakeBg:'pompeii-bg.png',
    azul:['Azul-doll.png','Azul-doll2.png','Azul-doll3.png','Azul-doll4.png'],
    buildings:['building-a.png','building-b.png','building-c.png'],
    loriBlur:'lori-blur.png', obstacles:['old-pc.png'], portal:'snack-portal.png'
};
const LOOT_HARDWARE=['power-supply.png','2tb.png','motherboard.png','ssd.png','graphics-card.png','circuitpython.png'];
const LOOT_SNACKS=['chips.png','hotdog.png','pink-donut.png','soda.png','taco.png','mochkil-burger.png','azulo_blueberry_vanilla.jpg'];

const imgCache={loot:[], snacks:[]};

// --- PARTICLES ---
let particles=[];
class Particle{
    constructor(x,y,color,text=null,sizeMod=1){
        this.x=x; this.y=y;
        this.char=text|| (Math.random()>0.5?"0":"1");
        this.size=(text?28:Math.random()*10+12) * sizeMod;
        this.speedX=(Math.random()-0.5)*12;
        this.speedY=text? -5 : (Math.random()-0.5)*15;
        this.color=color; this.life=1.0;
    }
    update(){ this.x+=this.speedX * timeScale; this.y+=this.speedY * timeScale; this.life-=0.018; }
    draw(){ ctx.save(); ctx.fillStyle=this.color; ctx.globalAlpha=this.life; ctx.font=`bold ${this.size}px monospace`; ctx.fillText(this.char,this.x,this.y); ctx.restore(); }
}

// --- BOILERPLATE: LOAD & RESIZE ---
function load(){
    Object.keys(ASSETS).forEach(key=>{
        if(Array.isArray(ASSETS[key])){
            imgCache[key]=ASSETS[key].map(src=>{let i=new Image(); i.src=src; return i;});
        }else{ let i=new Image(); i.src=ASSETS[key]; imgCache[key]=i; }
    });
    LOOT_HARDWARE.forEach(src=>{ let i=new Image(); i.src=src; imgCache.loot.push(i); });
    LOOT_SNACKS.forEach(src=>{ let i=new Image(); i.src=src; imgCache.snacks.push(i); });
}
load();

let drops=[];
function initMatrix(){ drops=Array(Math.floor(canvas.width/20)).fill(1); }
function resize(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; floorY=canvas.height-GROUND_Y_OFFSET; initMatrix(); }

// --- GAME LOGIC ---
function triggerBSOD(){ 
    gameState='GAMEOVER'; bgMusic.pause(); flashScreen();
    if(score>highScore){ highScore=score; localStorage.setItem('maxRealityHighScore',highScore); }
    document.getElementById('bsod').style.display='block';
    setTimeout(()=>{document.getElementById('bsod').style.display='none'; resetGame();}, 2000);
}

function resetGame() {
    score=0; frame=0; jumpHeight=0; yVelocity=0; shake=0; bonusCount=0;
    gameObjects=[]; portalActive=false; currentZone='CYBER'; gameSpeed=7; dimensionHue=0; timeScale=1.0;
    gameState='PLAYING'; bgMusic.play().catch(()=>{});
}

let gameObjects=[];
let lastPortalScore = 0;

function spawn() {
    // Portal every 5k points
    if(score >= 5000 && score - lastPortalScore >= 5000 && !portalActive) {
        portalActive=true; lastPortalScore=score;
        gameObjects.push({x:canvas.width+100, y:floorY-140, w:120, h:140, type:'portal', img:imgCache.portal});
    }
    
    // Regular Spawning
    const rate = currentZone === 'EARTHQUAKE' ? 60 : 85;
    if(frame % rate === 0) {
        const isLoot = Math.random() > 0.4;
        const pool = currentZone === 'SNACK' ? imgCache.snacks : imgCache.loot;
        gameObjects.push({
            x:canvas.width+100, y:floorY-85, w:80, h:80,
            type: isLoot ? 'tech' : 'obstacle',
            img: isLoot ? pool[Math.floor(Math.random()*pool.length)] : imgCache.obstacles[0]
        });
    }
    // Ash in EQ
    if(currentZone==='EARTHQUAKE' && frame%4===0) particles.push(new Particle(Math.random()*canvas.width, 0, `hsl(20,80%,${40+Math.random()*20}%)`, '¬∑', 2));
}

function drawBackground(){
    if(currentZone==='EARTHQUAKE' && imgCache.earthquakeBg.complete){
        let x=-((frame*(gameSpeed*0.2))%canvas.width);
        ctx.drawImage(imgCache.earthquakeBg,x,0,canvas.width,canvas.height);
        ctx.drawImage(imgCache.earthquakeBg,x+canvas.width,0,canvas.width,canvas.height);
        ctx.fillStyle="rgba(255,50,0,0.2)"; ctx.fillRect(0,0,canvas.width,canvas.height);
    } else if(currentZone==='SNACK' && imgCache.snackBg.complete){
        let x=-((frame*2)%canvas.width);
        ctx.drawImage(imgCache.snackBg,x,0,canvas.width,canvas.height);
        ctx.drawImage(imgCache.snackBg,x+canvas.width,0,canvas.width,canvas.height);
    } else {
        if(imgCache.bg.complete) ctx.drawImage(imgCache.bg,0,0,canvas.width,canvas.height);
        // Parallax Buildings
        const layers=[{img:imgCache.buildings[2],s:0.8,op:0.2,h:550},{img:imgCache.buildings[1],s:1.8,op:0.4,h:450},{img:imgCache.buildings[0],s:3.5,op:0.6,h:350}];
        layers.forEach(l=>{
            if(l.img.complete){
                ctx.save(); let x=-(frame*l.s)%canvas.width;
                ctx.globalAlpha=l.op; ctx.filter=`hue-rotate(${dimensionHue}deg)`;
                ctx.drawImage(l.img,x,floorY-l.h,canvas.width,l.h);
                ctx.drawImage(l.img,x+canvas.width,floorY-l.h,canvas.width,l.h);
                ctx.restore();
            }
        });
        // Rainbow Matrix
        ctx.save(); ctx.fillStyle=`hsl(${(frame*2)%360},100%,60%)`; ctx.font="bold 18px monospace";
        drops.forEach((y,i)=>{
            ctx.fillText(Math.random()>0.5?"1":"0",i*20,y*20);
            if(y*20>canvas.height && Math.random()>0.975) drops[i]=0;
            drops[i]++;
        });
        ctx.restore();
    }
    // Floor
    ctx.fillStyle="#000"; ctx.fillRect(0,floorY,canvas.width,GROUND_Y_OFFSET);
    if(imgCache.floor.complete){
        let fX=-(frame*gameSpeed)%100;
        for(let i=-1; i<(canvas.width/100)+2; i++) ctx.drawImage(imgCache.floor,(i*100)+fX,floorY,100,GROUND_Y_OFFSET);
    }
}

function flashScreen(){ const f=document.getElementById('flash'); f.style.opacity=1; setTimeout(()=>f.style.opacity=0,100); }

function loop(){
    if(isPaused){ requestAnimationFrame(loop); return; }
    ctx.save();
    if(shake>0){ ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake); shake*=0.85; }
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawBackground();
    for(let i=particles.length-1; i>=0; i--){ particles[i].update(); particles[i].draw(); if(particles[i].life<=0) particles.splice(i,1); }

    if(gameState==='PLAYING'){
        frame++; spawn();
        jumpHeight -= yVelocity * timeScale; yVelocity += gravity * timeScale;
        if(jumpHeight<=0){ 
            if(yVelocity > 0) { shake = (currentZone==='EARTHQUAKE')?20:8; coyoteFrames=6; }
            jumpHeight=0; yVelocity=0; 
        } else { coyoteFrames--; }

        // Azul Render
        const aFrame=Math.floor(frame/6)%4;
        ctx.save();
        if(currentZone==='EARTHQUAKE') ctx.filter="brightness(1.2) drop-shadow(0 0 10px #f50)";
        ctx.drawImage(imgCache.azul[aFrame],100,floorY-110-jumpHeight,90,115);
        ctx.restore();

        // Game Objects
        for(let i=gameObjects.length-1; i>=0; i--){
            let obj = gameObjects[i];
            obj.x -= gameSpeed * timeScale;

            // Hitbox Logic
            let buffer = (obj.type==='tech')?35:0;
            if(obj.x < 160 && obj.x > 80 && jumpHeight < (70 + buffer)){
                if(obj.type==='tech'){
                    bonusCount++; score += (100 * Math.min(bonusCount, 10));
                    dimensionHue += 5;
                    particles.push(new Particle(obj.x, obj.y, '#fff', `+${100*bonusCount}`));
                    for(let j=0; j<10; j++) particles.push(new Particle(obj.x, obj.y, '#0ff'));
                    gameObjects.splice(i,1);
                } else if(obj.type==='portal'){
                    flashScreen();
                    if(currentZone==='CYBER') currentZone='SNACK';
                    else if(currentZone==='SNACK'){ currentZone='EARTHQUAKE'; gameSpeed=12; beastModeSfx.play(); }
                    else { currentZone='CYBER'; gameSpeed=7; }
                    portalActive=false; gameObjects=[];
                } else { triggerBSOD(); }
            }
            if(obj.img) ctx.drawImage(obj.img, obj.x, obj.y, obj.w, obj.h);
            if(obj.x < -150) gameObjects.splice(i,1);
        }

        document.getElementById('score').innerText=`DIMENSION: ${score}`;
        document.getElementById('highScore').innerText=`BEST: ${highScore}`;
        document.getElementById('status').innerText=`ZONE: ${currentZone}`;
        if(score > highScore && highScore > 0) document.getElementById('score').classList.add('new-record');
    } else {
        ctx.fillStyle="rgba(0,0,0,0.8)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#0ff"; ctx.textAlign="center"; ctx.font="24px Courier";
        ctx.fillText("TAP TO INJECT CODE", canvas.width/2, canvas.height/2);
    }
    ctx.restore();
    requestAnimationFrame(loop);
}

// --- INPUTS ---
window.addEventListener('touchstart', e=>{
    if(e.target.closest('.btn')) return;
    if(gameState!=='PLAYING') resetGame();
    else if(jumpHeight===0 || coyoteFrames > 0) { yVelocity=-22; coyoteFrames=0; }
    e.preventDefault();
},{passive:false});

document.getElementById('muteBtn').addEventListener('touchstart', e=>{ e.stopPropagation(); isMuted=!isMuted; bgMusic.muted=isMuted; beastModeSfx.muted=isMuted; document.getElementById('muteBtn').innerText=isMuted?'üîá':'üîä'; });
document.getElementById('pauseBtn').addEventListener('touchstart', e=>{ e.stopPropagation(); isPaused=!isPaused; document.getElementById('pauseBtn').style.borderColor=isPaused?'#ff0':'#0ff'; });

resize(); window.addEventListener('resize', resize);
loop();
</script>
</body>
</html>
