<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Maximum Reality: Comfort</title>
  <meta name="description" content="Maximum Reality: Comfort ‚Äî a relaxed neon cyber arcade experience.">
  
  <link rel="icon" type="image/png" sizes="16x16" href="https://maximumreality.github.io/dimensions/Banner-40.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://maximumreality.github.io/dimensions/Banner-40.png">
  <link rel="icon" type="image/png" sizes="48x48" href="https://maximumreality.github.io/dimensions/Banner-40.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://maximumreality.github.io/dimensions/Banner-40.png">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    body, html {margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000;font-family:'Courier New',monospace;}
    #gameCanvas {display:block;width:100vw;height:100vh;background:#000;}
    .ui-layer {position:absolute;top:env(safe-area-inset-top);left:20px;color:#0ff;z-index:100;pointer-events:none;text-shadow:0 0 8px #0ff;}
    #score {font-size:24px;font-weight:bold;}
    #highScore {font-size:14px;opacity:0.8;margin-top:5px;}
    #status {font-size:16px;margin-top:8px;}
    #invincible {font-size:12px;opacity:0.6;margin-top:4px;color:#ff0;}
    .controls {position:absolute;top:calc(env(safe-area-inset-top)+30px);right:20px;display:flex;gap:15px;z-index:150;}
    .btn {font-size:24px;background:rgba(0,255,255,0.15);border:1.5px solid #0ff;border-radius:8px;padding:8px 12px;color:#0ff;cursor:pointer;backdrop-filter:blur(5px);user-select:none;touch-action:manipulation;}
    #bsod {position:fixed;inset:0;background:#0000aa;color:#fff;display:none;z-index:200;padding:50px;text-align:center;font-family:'Courier New';}
    #flash {position:fixed;inset:0;background:#fff;opacity:0;z-index:250;pointer-events:none;transition:opacity 0.1s;}
    #startOverlay {position:fixed;inset:0;background:rgba(0,0,0,0.9);color:#0ff;z-index:300;display:flex;align-items:center;justify-content:center;pointer-events:auto;}
    #hardModeBtn {text-shadow:0 0 10px #f0f;animation:pulse 1.5s infinite;}
    @keyframes pulse {0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
  </style>
</head>
<body>

<div id="bsod"><h1>:(</h1><p>CRITICAL DIMENSION ERROR</p><p>REBOOTING SIMULATION...</p></div>
<div id="flash"></div>

<div id="startOverlay">
  <div style="text-align:center;">
    <div style="font-size:32px;margin-bottom:30px;">COMFORT REALITY</div>
    <div style="display:flex;gap:20px;justify-content:center;">
      <div id="hardModeBtn" class="btn" style="font-size:20px;padding:20px;border-color:#f0f;color:#f0f;">CHAOS</div>
      <div id="easyModeBtn" class="btn" style="font-size:20px;padding:20px;border-color:#0ff;color:#0ff;">COMFORT</div>
    </div>
  </div>
</div>

<div class="controls">
  <a href="https://maximumreality.xyz" class="btn">üè†</a>
  <div id="muteBtn" class="btn">üîä</div>
  <div id="pauseBtn" class="btn">‚èØÔ∏è</div>
</div>

<div class="ui-layer">
  <div id="score">DIMENSION: 0</div>
  <div id="highScore">BEST: 0</div>
  <div id="status">ZONE: CYBER</div>
  <div id="invincible"></div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
// ======================== CORE SETUP ========================
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const bgMusic = new Audio('password-infinity.mp3'); bgMusic.loop = true;
const beastModeSfx = new Audio('beast_mode.mp3');

let isMuted = false, isPaused = false, gameState = 'START';
let score = 0, highScore = Number(localStorage.getItem('maxRealityHighScore')) || 0;
let frame = 0, gameSpeed = 3.5; // ‚Üê Super chill speed
let dimensionHue = 0, jumpHeight = 0, yVelocity = 0, shake = 0;
let bonusCount = 0, currentZone = 'CYBER', portalActive = false;
let lastPortalScore = 0, invincibleFrames = 0;

const gravity = 0.85;          // Floaty, forgiving gravity
const GROUND_Y_OFFSET = 100;
let floorY;

// ======================== ASSETS ========================
const ASSETS = {
  bg:'gg-bg.png', snackBg:'hot-food-c-store-wp.JPG', earthquakeBg:'pompeii-bg.png',
  floor:'floor.png', loriBlur:'lori-blur.png', portal:'snack-portal.png', pc:'old-pc.png',
  azul:['Azul-doll.png','Azul-doll2.png','Azul-doll3.png','Azul-doll4.png'],
  buildings:['building-a.png','building-b.png','building-c.png']
};

const CYBER_LOOT = ['2tb.png','card.png','circuitpython.png','core-i7.png','core-i9.png','cpu-water-cooler.png','curve-keyboard.png','graphics-card.png','motherboard.png','optical-drive.png','power-supply.png','ram.png','ssd.png'];
const SNACK_LOOT = ['azulo_blueberry_vanilla.jpg','bread-slice.png','chips.png','hotdog.png','mochkil-burger.png','mochkil_puffs_orange.png','pink-donut.png','roast-chicken.png','soda.png','taco.png'];
const EARTHQUAKE_LOOT = ['book.png','scrolls.png','pottery.png','pottery2.png','pottery3.png','pottery4.png'];
const EARTHQUAKE_OBSTACLES = ['herc-bust.png','rubble.png'];

const imgCache = {CYBER_LOOT:[], SNACK_LOOT:[], EARTHQUAKE_LOOT:[], EARTHQUAKE_OBSTACLES:[]};

// Load all images
function loadAssets() {
  Object.keys(ASSETS).forEach(k => { if(!Array.isArray(ASSETS[k])) { const i=new Image(); i.src=ASSETS[k]; imgCache[k]=i; }});
  ASSETS.azul.forEach(src=>{const i=new Image();i.src=src;imgCache.azul.push(i);});
  ASSETS.buildings.forEach(src=>{const i=new Image();i.src=src;imgCache.buildings.push(i);});
  [...CYBER_LOOT, ...SNACK_LOOT, ...EARTHQUAKE_LOOT, ...EARTHQUAKE_OBSTACLES].forEach(src=>{const i=new Image();i.src=src;
    if(CYBER_LOOT.includes(src)) imgCache.CYBER_LOOT.push(i);
    else if(SNACK_LOOT.includes(src)) imgCache.SNACK_LOOT.push(i);
    else if(EARTHQUAKE_LOOT.includes(src)) imgCache.EARTHQUAKE_LOOT.push(i);
    else imgCache.EARTHQUAKE_OBSTACLES.push(i);
  });
}
loadAssets();

// ======================== PARTICLES ========================
let particles = [];
class Particle {
  constructor(x,y,color,text=null,sizeMod=1){this.x=x;this.y=y;this.char=text||(Math.random()>0.5?"0":"1");this.size=(text?28:Math.random()*10+12)*sizeMod;this.speedX=(Math.random()-0.5)*10;this.speedY=(Math.random()-0.5)*10;this.color=color;this.life=1;}
  update(){this.x+=this.speedX;this.y+=this.speedY;this.life-=0.02;}
  draw(){ctx.save();ctx.fillStyle=this.color;ctx.globalAlpha=this.life;ctx.font=`bold ${this.size}px monospace`;ctx.fillText(this.char,this.x,this.y);ctx.restore();}
}

// ======================== RESIZE & MATRIX ========================
let drops = [];
function initMatrix(){drops=Array(Math.floor(canvas.width/20)).fill(1);}
function resize(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;floorY=canvas.height-GROUND_Y_OFFSET;initMatrix();}
resize(); window.addEventListener('resize',resize);

// ======================== CONTROLS ========================
document.getElementById('muteBtn').addEventListener('touchstart',e=>{e.stopPropagation();isMuted=!isMuted;bgMusic.muted=isMuted;beastModeSfx.muted=isMuted;document.getElementById('muteBtn').innerText=isMuted?'üîá':'üîä';},{passive:false});
document.getElementById('pauseBtn').addEventListener('touchstart',e=>{e.stopPropagation();isPaused=!isPaused;document.getElementById('pauseBtn').style.borderColor=isPaused?'#ff0':'#0ff';},{passive:false});

// ======================== GAME STATE ========================
function triggerBSOD(){
  gameState='GAMEOVER';bgMusic.pause();
  if(score>highScore){highScore=score;localStorage.setItem('maxRealityHighScore',highScore);}
  document.getElementById('bsod').style.display='block';
  setTimeout(()=>{document.getElementById('bsod').style.display='none';resetGame();gameState='START';document.getElementById('startOverlay').style.display='flex';},2200);
}
function resetGame(){
  score=0;frame=0;jumpHeight=0;yVelocity=0;shake=0;bonusCount=0;gameObjects=[];portalActive=false;beastModePlayed=false;lastPortalScore=0;particles=[];currentZone='CYBER';gameSpeed=3.5;dimensionHue=0;invincibleFrames=0;
}
function flashScreen(){const f=document.getElementById('flash');f.style.opacity=1;setTimeout(()=>f.style.opacity=0,100);}

// ======================== SPAWN ========================
let gameObjects = [];
function spawn(){
  if(gameObjects.length>0 && gameObjects[gameObjects.length-1].x > canvas.width-400) return;
  
  // Portal every 5000 points - impossible to jump over
  if(score>=5000 && score-lastPortalScore>=5000 && !portalActive){
    portalActive=true;lastPortalScore=score;
    gameObjects.push({x:canvas.width+100,y:floorY-200,w:160,h:220,type:'portal',img:imgCache.portal}); // tall portal
    return;
  }

  // Obstacles - smaller and rarer
  if(frame%320===0){
    let img = currentZone==='EARTHQUAKE' ? imgCache.EARTHQUAKE_OBSTACLES[Math.floor(Math.random()*imgCache.EARTHQUAKE_OBSTACLES.length)] : imgCache.pc;
    gameObjects.push({x:canvas.width+100,y:floorY-50,w:70,h:50,type:'obstacle',img}); // tiny obstacles
    return;
  }

  // Loot
  if(frame%140===0){
    const lootArr = currentZone==='CYBER'?imgCache.CYBER_LOOT : currentZone==='SNACK'?imgCache.SNACK_LOOT : imgCache.EARTHQUAKE_LOOT;
    gameObjects.push({x:canvas.width+100,y:floorY-90,w:80,h:80,type:'tech',img:lootArr[Math.floor(Math.random()*lootArr.length)]});
  }
}

// ======================== GLOW ========================
function drawWithGlow(obj){
  ctx.save();
  ctx.shadowColor='#0ff';ctx.shadowBlur=25;ctx.shadowOffsetX=0;ctx.shadowOffsetY=0;
  ctx.drawImage(obj.img,obj.x,obj.y,obj.w,obj.h);
  ctx.restore();
}

// ======================== BACKGROUND ========================
function drawBackground(){
  ctx.fillStyle='#000';ctx.fillRect(0,0,canvas.width,canvas.height);

  // Zone backgrounds
  if(currentZone==='SNACK' && imgCache.snackBg?.complete){
    const x=-(frame*1.5)%canvas.width;
    ctx.drawImage(imgCache.snackBg,x,0,canvas.width,canvas.height);
    ctx.drawImage(imgCache.snackBg,x+canvas.width,0,canvas.width,canvas.height);
  }
  else if(currentZone==='EARTHQUAKE' && imgCache.earthquakeBg?.complete){
    const x=-(frame*1)%canvas.width;
    ctx.drawImage(imgCache.earthquakeBg,x,0,canvas.width,canvas.height);
    ctx.drawImage(imgCache.earthquakeBg,x+canvas.width,0,canvas.width,canvas.height);
  }
  else{
    if(imgCache.bg?.complete) ctx.drawImage(imgCache.bg,0,0,canvas.width,canvas.height);
    // parallax, matrix rain, etc.
  }

  // Ground
  ctx.fillStyle = currentZone==='EARTHQUAKE'?'#440':"#222";
  ctx.fillRect(0,floorY,canvas.width,GROUND_Y_OFFSET);
  if(imgCache.floor?.complete){
    const fX=-(frame*gameSpeed)%100;
    for(let i=-1;i<(canvas.width/100)+2;i++) ctx.drawImage(imgCache.floor,(i*100)+fX,floorY,100,GROUND_Y_OFFSET);
  }
}

// ======================== MAIN LOOP ========================
function loop(){
  if(isPaused){requestAnimationFrame(loop);return;}
  if(gameState!=='PLAYING'){requestAnimationFrame(loop);return;}

  ctx.save();
  if(shake>0){ctx.translate((Math.random()-0.5)*shake,(Math.random()-0.5)*shake);shake*=0.88;if(shake<0.2)shake=0;}
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawBackground();
  particles.forEach((p,i)=>{p.update();p.draw();if(p.life<=0)particles.splice(i,1);});

  frame++; if(invincibleFrames>0) invincibleFrames--;
  spawn();

  // Physics - super forgiving
  jumpHeight -= yVelocity; yVelocity += gravity;
  if(jumpHeight<=0){jumpHeight=0;yVelocity=0;}

  // Draw Azul - now tall and beautiful!
  const animFrame = Math.floor(frame/7)%4;
  if(imgCache.azul[animFrame]?.complete){
    ctx.drawImage(imgCache.azul[animFrame], 100, floorY - 155 - jumpHeight, 105, 165); // TALL CAT
  }

  // Player hitbox (forgiving)
  const player = {x:100, y:floorY-155-jumpHeight, width:52, height:140};

  for(let i=gameObjects.length-1;i>=0;i--){
    const obj=gameObjects[i]; obj.x -= gameSpeed;

    // Collision
    const objBox = {x:obj.x+15, y:obj.y+15, width:obj.w-30, height:obj.h-30};
    const colliding = player.x < objBox.x+objBox.width && player.x+player.width > objBox.x &&
                      player.y < objBox.y+objBox.height && player.y+player.height > objBox.y;

    if(colliding || (obj.type==='portal' && obj.x<250 && obj.x+obj.w>80)){ // force portal entry
      if(obj.type==='tech'){
        bonusCount=Math.min(bonusCount+1,10);
        const points=100*bonusCount;
        score+=points; dimensionHue+=5;
        particles.push(new Particle(obj.x+40,obj.y+40,'#fff',`+${points}`,1.5));
        gameObjects.splice(i,1); continue;
      }
      if(obj.type==='portal'){
        flashScreen(); invincibleFrames=180; // 3 seconds invincibility
        if(currentZone==='CYBER'){currentZone='SNACK';gameSpeed=4.2;}
        else if(currentZone==='SNACK'){currentZone='EARTHQUAKE';gameSpeed=5;beastModeSfx.play();}
        else{currentZone='CYBER';gameSpeed=3.5;}
        bonusCount=0; portalActive=false; gameObjects=[]; particles=[];
        continue;
      }
      if(obj.type==='obstacle' && invincibleFrames<=0){
        flashScreen(); shake=20; triggerBSOD();
      }
    }

    // Draw
    if(obj.img?.complete){
      if(obj.type==='tech' || obj.type==='portal') drawWithGlow(obj);
      else ctx.drawImage(obj.img,obj.x,obj.y,obj.w,obj.h);
    }

    if(obj.x<-200) gameObjects.splice(i,1);
  }

  // UI
  document.getElementById('score').innerText=`DIMENSION: ${score}`;
  document.getElementById('highScore').innerText=`BEST: ${highScore}`;
  document.getElementById('status').innerText=`ZONE: ${currentZone}`;
  document.getElementById('invincible').innerText=invincibleFrames>0?`INVINCIBLE: ${Math.ceil(invincibleFrames/60)}s`:'';
  
  ctx.restore();
  requestAnimationFrame(loop);
}

// ======================== INPUT ========================
document.getElementById('hardModeBtn').onclick=()=>location.href='index.html';
document.getElementById('easyModeBtn').onclick=()=>{
  document.getElementById('startOverlay').style.display='none';
  resetGame(); gameState='PLAYING'; bgMusic.play().catch(()=>{});
};

window.addEventListener('touchstart',e=>{
  if(gameState==='PLAYING' && jumpHeight===0 && !e.target.closest('.btn')){
    yVelocity = -34; // beautiful high jumps
    e.preventDefault();
  }
},{passive:false});

loop();
if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
</script>
</body>
</html>
