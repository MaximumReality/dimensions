<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Maximum Reality: Beast Mode</title>
<style>
body, html {margin:0;padding:0;width:100%;height:100%;overflow:hidden;background:#000;-webkit-user-select:none;touch-action:none;}
#gameCanvas {display:block;width:100vw;height:100vh;background:#000;}
.ui-layer {position:absolute;top:env(safe-area-inset-top);left:20px;color:#0ff;font-family:'Courier New', monospace;z-index:100;pointer-events:none;text-shadow:0 0 8px #0ff;}
#score {font-size:24px;font-weight:bold;}
#status {font-size:18px;margin-top:5px;}
.controls {position:absolute;top:env(safe-area-inset-top);right:20px;display:flex;gap:15px;z-index:150;}
.btn {font-size:24px;background:rgba(0,255,255,0.15);border:1.5px solid #0ff;border-radius:8px;padding:8px;color:#0ff;cursor:pointer;backdrop-filter:blur(5px);display:flex;align-items:center;justify-content:center;}
#bsod {position:fixed;top:0;left:0;width:100%;height:100%;background:#0000aa;color:#fff;font-family:'Courier New';display:none;z-index:200;padding:50px;box-sizing:border-box;}
#flash {position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;opacity:0;z-index:250;pointer-events:none;transition:opacity 0.15s;}
</style>
</head>
<body>

<div id="flash"></div>
<div id="bsod"><h1>:(</h1><p>CRITICAL_DIMENSION_ERROR</p><p>REBOOTING...</p></div>
<div class="controls">
    <a href="https://MaximumReality.xyz" class="btn">üè†</a>
    <div id="muteBtn" class="btn">üîä</div>
    <div id="pauseBtn" class="btn">‚èØÔ∏è</div>
</div>
<div class="ui-layer">
    <div id="score">DIMENSION: 0</div>
    <div id="status">ZONE: CYBER</div>
</div>
<canvas id="gameCanvas"></canvas>

<script>
// --- CANVAS & AUDIO ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const bgMusic = new Audio('password-infinity.mp3');
const beastModeSfx = new Audio('beast_mode.mp3');
bgMusic.loop = true;

let isMuted=false, isPaused=false, gameState='START';
let score=0, frame=0, gameSpeed=7, dimensionHue=0;
let jumpHeight=0, yVelocity=0, shake=0, dimensionLevel=1;
let currentZone='CYBER', earthquakeActive=false, beastPlayed=false;
const gravity=1.2, GROUND_Y_OFFSET=100;
let floorY, portalActive=false;

// --- ASSETS & LOOT ---
const ASSETS={
    bg:'gg-bg.png',
    floor:'floor.png',
    azul:['Azul-doll.png','Azul-doll2.png','Azul-doll3.png','Azul-doll4.png'],
    buildings:['building-a.png','building-b.png','building-c.png'],
    loriBlur:'lori-blur.png',
    obstacles:['old-pc.png'],
    snackBg:'hot-food-c-store-wp.JPG',
    portal:'snack-portal.png'
};
const OUTSIDE_LOOT=['power-supply.png','2tb.png','card.png','core-i7.png','curve-keyboard.png','core-i9.png','cpu-water-cooler.png','optical-drive.png','ram.png','motherboard.png','ssd.png','graphics-card.png','circuitpython.png'];
const SNACK_LOOT=['bread-slice.png','chips.png','hotdog.png','pink-donut.png','roast-chicken.png','soda.png','taco.png','mochkil-burger.png','mochkil_puffs_orange.png','azulo_blueberry_vanilla.jpg'];

const imgCache={loot:[]};

// --- PARTICLES ---
let particles=[];
class Particle{
    constructor(x,y,color,text=null){
        this.x=x; this.y=y;
        this.char=text|| (Math.random()>0.5?"0":"1");
        this.size=text?28:Math.random()*10+12;
        this.speedX=(Math.random()-0.5)*10;
        this.speedY=(Math.random()-0.5)*10;
        this.color=color; this.life=1.0;
    }
    update(){ this.x+=this.speedX; this.y+=this.speedY; this.life-=0.02; }
    draw(){ ctx.save(); ctx.fillStyle=this.color; ctx.globalAlpha=this.life; ctx.font=`bold ${this.size}px monospace`; ctx.fillText(this.char,this.x,this.y); ctx.restore(); }
}

// --- IMAGE LOADING ---
function load(){
    Object.keys(ASSETS).forEach(key=>{
        if(Array.isArray(ASSETS[key])){
            imgCache[key]=ASSETS[key].map(src=>{let i=new Image();i.src=src;return i;});
        }else{ let i=new Image(); i.src=ASSETS[key]; imgCache[key]=i; }
    });
    OUTSIDE_LOOT.forEach(src=>{ let i=new Image();i.src=src; imgCache.loot.push(i); });
    SNACK_LOOT.forEach(src=>{ let i=new Image();i.src=src; imgCache.loot.push(i); });
}
load();

// --- MATRIX DROPS ---
let drops=[];
function resize(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; floorY=canvas.height-GROUND_Y_OFFSET; drops=Array(Math.floor(canvas.width/20)).fill(1); }
resize(); window.addEventListener('resize',resize);

// --- FLASH ---
function flash(){ const f=document.getElementById('flash'); f.style.opacity=1; setTimeout(()=>f.style.opacity=0,150); }

// --- SPAWN ---
let gameObjects=[];
function spawn(){
    // Portal every 5000 points
    if(score>0 && score%5000===0 && !portalActive){
        portalActive=true;
        gameObjects.push({x:canvas.width+100,y:floorY-140,w:120,h:140,type:'portal',img:imgCache.portal});
        return;
    }

    // Loot / obstacles
    let lootPool=currentZone==='SNACK'?SNACK_LOOT:OUTSIDE_LOOT;
    if(frame%80===0){
        const isLoot=Math.random()>0.4;
        gameObjects.push({
            x:canvas.width+100,
            y:floorY-85,
            w:80,h:80,
            type:isLoot?'tech':'obstacle',
            img:isLoot?imgCache.loot[Math.floor(Math.random()*lootPool.length)]:imgCache.obstacles[0]
        });
    }
}

// --- DIMENSION LOGIC ---
function enterDimension(level){
    dimensionLevel=level;
    if(level===1){ currentZone='CYBER'; gameSpeed=5; earthquakeActive=false; }
    else if(level===2){ currentZone='SNACK'; gameSpeed=7; earthquakeActive=false; }
    else if(level===3){ currentZone='CYBER'; gameSpeed=9; earthquakeActive=true; if(!beastPlayed){ beastModeSfx.play(); beastPlayed=true; } }
}

// --- DRAW BACKGROUND ---
function drawBackground(){
    if(currentZone==='CYBER'){
        if(imgCache.bg.complete) ctx.drawImage(imgCache.bg,0,0,canvas.width,canvas.height);
        if(imgCache.loriBlur.complete){
            ctx.save(); ctx.globalAlpha=0.4;
            let lX=-(frame*0.5)%canvas.width;
            ctx.drawImage(imgCache.loriBlur,lX,0,canvas.width,canvas.height);
            ctx.drawImage(imgCache.loriBlur,lX+canvas.width,0,canvas.width,canvas.height);
            ctx.restore();
        }
        // Buildings
        imgCache.buildings.forEach((b,i)=>{
            if(b.complete){
                ctx.save();
                ctx.globalAlpha=0.4 + i*0.2;
                ctx.drawImage(b, -(frame*(1+i*0.5))%canvas.width, floorY-350, canvas.width, 350);
                ctx.drawImage(b, -(frame*(1+i*0.5))%canvas.width + canvas.width, floorY-350, canvas.width, 350);
                ctx.restore();
            }
        });
        // Rainbow matrix
        ctx.save(); ctx.fillStyle=`hsl(${(frame*2)%360},100%,60%)`; ctx.font="bold 18px monospace";
        drops.forEach((y,i)=>{
            ctx.fillText(Math.random()>0.5?"1":"0",i*20,y*20);
            if(y*20>canvas.height && Math.random()>0.975) drops[i]=0;
            drops[i]++;
        });
        ctx.restore();
    } else { // SNACK
        if(imgCache.snackBg.complete){
            let x=-((frame*3)%canvas.width);
            ctx.drawImage(imgCache.snackBg,x,0,canvas.width,canvas.height);
            ctx.drawImage(imgCache.snackBg,x+canvas.width,0,canvas.width,canvas.height);
        }
    }
    // Ground
    ctx.fillStyle="#222"; ctx.fillRect(0,floorY,canvas.width,GROUND_Y_OFFSET);
    if(imgCache.floor.complete){
        let fX = -(frame*gameSpeed)%100;
        for(let i=-1;i<(canvas.width/100)+2;i++) ctx.drawImage(imgCache.floor,(i*100)+fX,floorY,100,GROUND_Y_OFFSET);
    }
}

// --- MAIN LOOP ---
function loop(){
    if(isPaused){ requestAnimationFrame(loop); return; }
    ctx.save();
    if(shake>0){ ctx.translate((Math.random()-0.5)*shake,(Math.random()-0.5)*shake); shake*=0.85; }
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBackground();

    if(gameState==='PLAYING'){
        frame++; spawn();
        jumpHeight-=yVelocity; yVelocity+=gravity;
        let landed=false;
        if(jumpHeight<=0){ jumpHeight=0; yVelocity=0; landed=true; }

        // Shake on land if earthquake
        if(landed && earthquakeActive) shake=15;

        // Azul
        const aFrame=Math.floor(frame/6)%4;
        ctx.drawImage(imgCache.azul[aFrame],100,floorY-110-jumpHeight,90,115);

        // Objects
        gameObjects.forEach((obj,i)=>{
            obj.x-=gameSpeed;
            // COLLISIONS
            if(obj.x<160 && obj.x>80 && jumpHeight<70){
                if(obj.type==='portal'){
                    flash();
                    enterDimension(dimensionLevel+1);
                    portalActive=false;
                    gameObjects=[];
                } else if(obj.type==='tech'){
                    let points=100;
                    score+=points;
                    for(let j=0;j<8;j++) particles.push(new Particle(obj.x,obj.y,`hsl(${dimensionHue},100%,50%)`,'+'+points));
                    gameObjects.splice(i,1);
                } else { gameState='START'; }
            }
            if(obj.img) ctx.drawImage(obj.img,obj.x,obj.y,obj.w,obj.h);
            if(obj.x<-100) gameObjects.splice(i,1);
        });

        // PARTICLES
        particles.forEach((p,i)=>{ p.update(); p.draw(); if(p.life<=0) particles.splice(i,1); });

        // UI
        document.getElementById('score').innerText=`DIMENSION: ${score}`;
        document.getElementById('status').innerText=`ZONE: ${currentZone} ${earthquakeActive?'(BEAST MODE)':''}`;
    } else {
        ctx.fillStyle="rgba(0,0,0,0.8)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#0ff"; ctx.textAlign="center"; ctx.font="24px Courier";
        ctx.fillText("TAP TO INJECT CODE",canvas.width/2,canvas.height/2);
    }

    ctx.restore();
    requestAnimationFrame(loop);
}

// --- CONTROLS ---
document.getElementById('muteBtn').addEventListener('touchstart',e=>{e.stopPropagation();isMuted=!isMuted; bgMusic.muted=isMuted; document.getElementById('muteBtn').innerText=isMuted?'üîá':'üîä';},{passive:false});
document.getElementById('pauseBtn').addEventListener('touchstart',e=>{e.stopPropagation();isPaused=!isPaused; document.getElementById('pauseBtn').style.borderColor=isPaused?'#ff0':'#0ff';},{passive:false});

window.addEventListener('touchstart',e=>{
    if(e.target.closest('.btn')) return;
    if(gameState!=='PLAYING'){ gameState='PLAYING'; score=0; frame=0; gameObjects=[]; portalActive=false; beastPlayed=false; earthquakeActive=false; currentZone='CYBER'; bgMusic.play(); }
    else if(jumpHeight===0) yVelocity=-22;
    e.preventDefault();
},{passive:false});

loop();
</script>
</body>
</html>
