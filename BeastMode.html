<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Maximum Reality: Beast Mode</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; -webkit-user-select: none; touch-action: none; }
        #gameCanvas { display: block; width: 100vw; height: 100vh; background: #000; }
        .ui-layer { position: absolute; top: env(safe-area-inset-top); left: 20px; color: #0ff; font-family: 'Courier New', monospace; z-index: 100; pointer-events: none; text-shadow: 0 0 8px #0ff; }
        #score { font-size: 24px; font-weight: bold; }
        .controls { position: absolute; top: env(safe-area-inset-top); right: 20px; display: flex; gap: 15px; z-index: 150; }
        .btn { font-size: 24px; background: rgba(0, 255, 255, 0.15); border: 1.5px solid #0ff; border-radius: 8px; padding: 8px; color: #0ff; cursor: pointer; backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; }
        #bsod { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0000aa; color: #fff; font-family: 'Courier New'; display: none; z-index: 200; padding: 50px; box-sizing: border-box; }
        #flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; opacity: 0; z-index: 250; pointer-events: none; transition: opacity 0.1s; }
    </style>
</head>
<body>
    <div id="flash"></div>
    <div id="bsod"><h1>:(</h1><p>CRITICAL_DIMENSION_ERROR</p><p>REBOOTING...</p></div>
    <div class="controls">
        <a href="https://MaximumReality.xyz" class="btn">üè†</a>
        <div id="muteBtn" class="btn">üîä</div>
        <div id="pauseBtn" class="btn">‚èØÔ∏è</div>
    </div>
    <div class="ui-layer">
        <div id="score">DIMENSION: 0</div>
        <div id="status">ZONE: CYBER</div>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const bgMusic = new Audio('password-infinity.mp3');
const beastModeSfx = new Audio('beast_mode.mp3');
bgMusic.loop = true;

let isMuted = false, isPaused = false, gameState = 'START';
let score = 0, frame = 0, gameSpeed = 7;
let jumpHeight = 0, yVelocity = 0, shake = 0;
let dimensionLevel = 1;
let currentZone = 'CYBER';
let earthquakeActive = false;
let portalActive = false;
let lastPortalScore = 0;

const gravity = 1.2, GROUND_Y_OFFSET = 100;
let floorY;

const ASSETS = {
    bg: 'gg-bg.png',
    snackBg: 'hot-food-c-store-wp.JPG',
    floor: 'floor.png',
    azul: ['Azul-doll.png','Azul-doll2.png','Azul-doll3.png','Azul-doll4.png'],
    buildings: ['building-a.png','building-b.png','building-c.png'],
    loriBlur: 'lori-blur.png',
    obstacles: ['old-pc.png'],
    portal: 'snack-portal.png'
};

const LOOT = [
    'power-supply.png','2tb.png','motherboard.png',
    'ssd.png','graphics-card.png','taco.png',
    'soda.png','pink-donut.png'
];

const imgCache = { loot: [] };
let gameObjects = [];
let drops = [];

/* LOAD */
function load(){
    Object.keys(ASSETS).forEach(key=>{
        if(Array.isArray(ASSETS[key])){
            imgCache[key] = ASSETS[key].map(src=>{
                let i = new Image(); i.src = src; return i;
            });
        } else {
            let i = new Image();
            i.src = ASSETS[key];
            imgCache[key] = i;
        }
    });
    LOOT.forEach(src=>{
        let i = new Image();
        i.src = src;
        imgCache.loot.push(i);
    });
}

/* RESIZE */
function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    floorY = canvas.height - GROUND_Y_OFFSET;
    drops = Array(Math.floor(canvas.width/20)).fill(1);
}

/* FLASH */
function flash(){
    const f = document.getElementById('flash');
    f.style.opacity = 1;
    setTimeout(()=>f.style.opacity = 0,150);
}

/* SPAWN */
function spawn(){

    // PORTAL (only once per 5000 milestone)
    if(score > 0 && score % 5000 === 0 && score !== lastPortalScore){
        lastPortalScore = score;
        portalActive = true;
        gameObjects.push({
            x: canvas.width + 100,
            y: floorY - 140,
            w: 120,
            h: 140,
            type: 'portal',
            img: imgCache.portal
        });
    }

    // NORMAL OBJECTS
    if(frame % 80 === 0){
        const isLoot = Math.random() > 0.4;
        gameObjects.push({
            x: canvas.width + 100,
            y: floorY - 85,
            w: 80,
            h: 80,
            type: isLoot ? 'tech' : 'obstacle',
            img: isLoot
                ? imgCache.loot[Math.floor(Math.random()*imgCache.loot.length)]
                : imgCache.obstacles[0]
        });
    }
}

/* BACKGROUND */
function drawBackground(){

    if(currentZone === 'CYBER'){
        if(imgCache.bg.complete)
            ctx.drawImage(imgCache.bg,0,0,canvas.width,canvas.height);

        ctx.save();
        ctx.fillStyle = `hsl(${(frame*2)%360},100%,60%)`;
        ctx.font = "16px monospace";
        drops.forEach((y,i)=>{
            ctx.fillText(Math.random()>0.5?"1":"0", i*20, y*20);
            if(y*20 > canvas.height && Math.random()>0.975) drops[i]=0;
            drops[i]++;
        });
        ctx.restore();

    } else {

        if(imgCache.snackBg.complete){
            let sX = -(frame*3)%canvas.width;
            ctx.drawImage(imgCache.snackBg,sX,0,canvas.width,canvas.height);
            ctx.drawImage(imgCache.snackBg,sX+canvas.width,0,canvas.width,canvas.height);
        }
    }

    // GROUND
    ctx.fillStyle="#000";
    ctx.fillRect(0,floorY,canvas.width,GROUND_Y_OFFSET);

    if(imgCache.floor.complete){
        let fX = -(frame*gameSpeed)%100;
        for(let i=-1;i<(canvas.width/100)+2;i++){
            ctx.drawImage(imgCache.floor,(i*100)+fX,floorY,100,GROUND_Y_OFFSET);
        }
    }
}

/* LOOP */
function loop(){

    if(isPaused){ requestAnimationFrame(loop); return; }

    ctx.save();

    if(shake>0){
        ctx.translate((Math.random()-0.5)*shake,(Math.random()-0.5)*shake);
        shake *= 0.85;
    }

    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawBackground();

    if(gameState==='PLAYING'){

        frame++;
        spawn();

        jumpHeight -= yVelocity;
        yVelocity += gravity;

        if(jumpHeight <= 0){
            if(yVelocity > 0 && earthquakeActive){
                shake = 20; // BEAST STOMP
            }
            jumpHeight = 0;
            yVelocity = 0;
        }

        const aFrame = Math.floor(frame/6)%4;
        ctx.drawImage(imgCache.azul[aFrame],100,floorY-110-jumpHeight,90,115);

        gameObjects.forEach((obj,i)=>{
            obj.x -= gameSpeed;

            if(obj.x<160 && obj.x>80 && jumpHeight<70){

                if(obj.type==='portal'){

                    flash();
                    dimensionLevel++;

                    if(dimensionLevel===2){
                        currentZone='SNACK';
                        earthquakeActive=false;
                    }
                    else if(dimensionLevel===3){
                        currentZone='CYBER';
                        earthquakeActive=true;

                        beastModeSfx.currentTime = 0;
                        beastModeSfx.play();
                    }
                    else{
                        dimensionLevel=1;
                        currentZone='CYBER';
                        earthquakeActive=false;
                    }

                    portalActive=false;
                    gameObjects=[];
                }

                else if(obj.type==='tech'){
                    score += 100;
                    gameObjects.splice(i,1);
                }

                else{
                    gameState='START';
                }
            }

            if(obj.img)
                ctx.drawImage(obj.img,obj.x,obj.y,obj.w,obj.h);
        });

        document.getElementById('score').innerText=`DIMENSION: ${score}`;
        document.getElementById('status').innerText =
            `ZONE: ${currentZone} ${earthquakeActive ? '(BEAST MODE)' : ''}`;
    }

    ctx.restore();
    requestAnimationFrame(loop);
}

/* TOUCH */
window.addEventListener('touchstart',(e)=>{

    if(e.target.closest('.btn')) return;

    if(gameState!=='PLAYING'){
        gameState='PLAYING';
        score=0;
        frame=0;
        dimensionLevel=1;
        currentZone='CYBER';
        earthquakeActive=false;
        portalActive=false;
        lastPortalScore=0;
        gameObjects=[];
        bgMusic.play();
    }
    else if(jumpHeight===0){
        yVelocity=-22;
    }

    e.preventDefault();

},{passive:false});

load();
resize();
loop();
</script>
</body>
</html>
